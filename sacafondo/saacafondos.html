<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Quitar fondo con remove.bg</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: monospace;
    text-align: center;
    padding: 2rem;
  }
  input, button {
    margin: 1rem;
    padding: 0.7rem 1.2rem;
    font-size: 1.1rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
  }
  button {
    background: #f03a3a;
    color: white;
  }
  img {
    margin-top: 1rem;
    max-width: 300px;
    border: 2px solid #0f0;
    border-radius: 8px;
    display: none;
  }
</style>
</head>
<body>

<h1>Quitar fondo con remove.bg</h1>

<input type="file" id="fileInput" accept="image/*" />
<br />
<button id="btnRemoveBg">ðŸ§¹ Quitar fondo</button>
<br />
<img id="resultImg" alt="Imagen sin fondo" />
<br />
<button id="downloadBtn" style="display:none;">ðŸ’¾ Descargar PNG sin fondo</button>

<script>
  const API_KEY = '6sS7uBJFkGLMWYboPJm3N6Me';
  const fileInput = document.getElementById('fileInput');
  const btn = document.getElementById('btnRemoveBg');
  const resultImg = document.getElementById('resultImg');
  const downloadBtn = document.getElementById('downloadBtn');

  let imgUrl = null;

  btn.onclick = async () => {
    if (!fileInput.files.length) {
      alert('Por favor selecciona una imagen primero.');
      return;
    }

    btn.disabled = true;
    btn.textContent = 'Procesando...';
    resultImg.style.display = 'none';
    downloadBtn.style.display = 'none';

    const file = fileInput.files[0];
    const formData = new FormData();
    formData.append('image_file', file);
    formData.append('size', 'auto');

    try {
      const response = await fetch('https://api.remove.bg/v1.0/removebg', {
        method: 'POST',
        headers: {
          'X-Api-Key': API_KEY
        },
        body: formData
      });

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`Error HTTP ${response.status}: ${errorText}`);
      }

      const blob = await response.blob();
      if (imgUrl) URL.revokeObjectURL(imgUrl);  // Liberar memoria si hay uno previo
      imgUrl = URL.createObjectURL(blob);

      resultImg.src = imgUrl;
      resultImg.style.display = 'block';

      downloadBtn.style.display = 'inline-block';
      downloadBtn.onclick = () => {
        const a = document.createElement('a');
        a.href = imgUrl;
        a.download = 'imagen-sin-fondo.png';
        a.click();
      };

    } catch (err) {
      alert('Error: ' + err.message);
      console.error(err);
    }

    btn.disabled = false;
    btn.textContent = 'ðŸ§¹ Quitar fondo';
  };
</script>

</body>
</html>
