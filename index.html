<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Integrar Logo Punk IA</title>
<style>
  body {
    background: black;
    color: #f0f0f0;
    font-family: 'Courier New', Courier, monospace;
    text-align: center;
    padding: 2rem;
  }
  input, button {
    margin: 0.5rem;
    padding: 0.5rem;
    border: 2px solid #f00;
    background: transparent;
    color: #f00;
    font-weight: bold;
    cursor: pointer;
  }
  button:hover {
    background: #f00;
    color: black;
  }
  #resultadoIA {
    max-width: 90vw;
    margin-top: 1rem;
    border: 4px solid #f00;
    display: none;
  }
  #downloadBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #f00;
    color: black;
    border: none;
    padding: 1rem 1.5rem;
    font-weight: bold;
    font-size: 1.2rem;
    cursor: pointer;
    border-radius: 10px;
    display: none;
    z-index: 100;
  }
</style>
</head>
<body>
<h1>Integrar Logo Punk IA</h1>

<label>Logo (archivo o URL):</label><br/>
<input type="file" id="logoFile" accept="image/*" />
<input type="url" id="logoUrl" placeholder="O pega la URL del logo" style="width: 300px;" />

<br/>

<label>Imagen de fondo (archivo o URL):</label><br/>
<input type="file" id="fondoFile" accept="image/*" />
<input type="url" id="fondoUrl" placeholder="O pega la URL de fondo" style="width: 300px;" />

<br/>

<button id="generarIA">Generar imagen con IA</button>

<br/>

<img id="resultadoIA" alt="Resultado IA" />

<button id="downloadBtn">Descargar imagen</button>

<script>
  const generarBtn = document.getElementById("generarIA");
  const resultado = document.getElementById("resultadoIA");
  const downloadBtn = document.getElementById("downloadBtn");

  function fileToDataUrl(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = e => resolve(e.target.result);
      reader.onerror = err => reject(err);
      reader.readAsDataURL(file);
    });
  }

  generarBtn.addEventListener("click", async () => {
    let logoData, fondoData;

    const logoFile = document.getElementById("logoFile").files[0];
    const logoUrl = document.getElementById("logoUrl").value.trim();
    const fondoFile = document.getElementById("fondoFile").files[0];
    const fondoUrl = document.getElementById("fondoUrl").value.trim();

    if (!logoFile && !logoUrl) {
      alert("Subí o pega la URL del logo");
      return;
    }

    if (!fondoFile && !fondoUrl) {
      alert("Subí o pega la URL de la imagen de fondo");
      return;
    }

    // Leer logo
    if (logoFile) {
      logoData = await fileToDataUrl(logoFile);
    } else {
      logoData = logoUrl;
    }

    // Leer fondo
    if (fondoFile) {
      fondoData = await fileToDataUrl(fondoFile);
    } else {
      fondoData = fondoUrl;
    }

    generarBtn.disabled = true;
    generarBtn.textContent = "Generando...";

    try {
      const resp = await fetch("https://aleotromundo.vercel.app/api/integrar-logo", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ logoData, fondoData }),
      });

      if (!resp.ok) {
        const err = await resp.json();
        alert("Error: " + (err.error || "Error desconocido"));
        generarBtn.disabled = false;
        generarBtn.textContent = "Generar imagen con IA";
        return;
      }

      const data = await resp.json();
      resultado.src = data.imageUrl;
      resultado.style.display = "block";

      downloadBtn.style.display = "inline-block";
      downloadBtn.onclick = () => {
        const a = document.createElement("a");
        a.href = data.imageUrl;
        a.download = "imagen-punk.png";
        a.click();
      };
    } catch (e) {
      alert("Error al generar: " + e.message);
    }

    generarBtn.disabled = false;
    generarBtn.textContent = "Generar imagen con IA";
  });
</script>

</body>
</html>
